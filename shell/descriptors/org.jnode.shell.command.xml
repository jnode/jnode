<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plugin SYSTEM "jnode.dtd">

<plugin id="org.jnode.shell.command"
  name="JNode System Commands"
  version="@VERSION@"
        license-name="lgpl"
  provider-name="JNode.org">

  <requires>
    <import plugin="org.jnode.shell.help"/>
  </requires>

  <runtime>
    <library name="jnode-shell.jar">
      <export name="org.jnode.shell.command.*"/>
    </library>
  </runtime>

  <extension point="org.jnode.shell.aliases">
    <alias name="alias" class="org.jnode.shell.command.AliasCommand"/>
    <alias name="class" class="org.jnode.shell.command.ClassCommand"/>
    <alias name="classpath" class="org.jnode.shell.command.ClasspathCommand" internal="yes"/>
    <alias name="compile" class="org.jnode.shell.command.CompileCommand"/>
    <alias name="disasm" class="org.jnode.shell.command.DisassembleCommand"/>
    <alias name="date" class="org.jnode.shell.command.DateCommand"/>
    <alias name="echo" class="org.jnode.shell.command.EchoCommand"/>
    <alias name="env" class="org.jnode.shell.command.EnvCommand"/>
    <alias name="exit" class="org.jnode.shell.command.ExitCommand"/>
    <alias name="set" class="org.jnode.shell.command.SetCommand"/>
    <alias name="gc" class="org.jnode.shell.command.GcCommand"/>
    <alias name="help" class="org.jnode.shell.command.HelpCommand"/>
    <alias name="history" class="org.jnode.shell.command.HistoryCommand"/>
    <alias name="isolate" class="org.jnode.shell.command.IsolateCommand"/>
    <alias name="java" class="org.jnode.shell.command.JavaCommand"/>
    <alias name="kill" class="org.jnode.shell.command.KillCommand"/>
    <alias name="memory" class="org.jnode.shell.command.MemoryCommand"/>
    <alias name="namespace" class="org.jnode.shell.command.NamespaceCommand"/>
    <alias name="thread" class="org.jnode.shell.command.ThreadCommand"/>
    <alias name="loadkeys" class="org.jnode.shell.command.LoadkeysCommand"/>
    <alias name="run" class="org.jnode.shell.command.RunCommand"/>
    <alias name="locale" class="org.jnode.shell.command.LocaleCommand"/>
    <alias name="onheap" class="org.jnode.shell.command.OnHeapCommand"/>
    <alias name="grep" class="org.jnode.shell.command.GrepCommand"/>
    <alias name="syntax" class="org.jnode.shell.command.SyntaxCommand"/>
  </extension>
  
  <extension point="org.jnode.shell.syntaxes">
    <syntax alias="alias">
      <empty description="List all aliases"/>
      <option argLabel="remove" shortName="r" description="Remove an alias"/>
      <sequence description="Create or update an alias">
        <argument argLabel="alias"/>
        <argument argLabel="className"/>
      </sequence>
    </syntax>
    <syntax alias="class" description="Show details of a Java class">
      <argument argLabel="className"/>
    </syntax>
    <syntax alias="classpath">
      <empty description="Print the current classpath"/>
      <option argLabel="addUrl" longName="add" description="Add a URL to the classpath"/>
      <option argLabel="clear" longName="clear" description="Remove all URLs from the classpath"/>
      <option argLabel="refresh" longName="refresh" description="Refresh the loaded classes on next use"/>
    </syntax>
    <syntax alias="compile" description="Compile a class to native code">
      <sequence>
        <optionSet>
          <option argLabel="test" longName="test"/>
          <option argLabel="level" longName="level"/>
        </optionSet>
        <argument argLabel="className"/>
      </sequence>
    </syntax>
    <syntax alias="date" description="Print the current date"/>
    <syntax alias="disasm" description="Disassemble a native code class">
      <sequence>
        <optionSet>
          <option argLabel="test" longName="test"/>
          <option argLabel="level" longName="level"/>
        </optionSet>
        <argument argLabel="className"/>
        <optional><argument argLabel="methodName"/></optional>
      </sequence>
    </syntax>
    <syntax alias="echo" description="Print the arguments">
      <repeat>
        <argument argLabel="text"/>
      </repeat>
    </syntax>
    <syntax alias="env" description="Print the system properties"/>
    <syntax alias="exit" description="Exit the current shell"/>
    <syntax alias="gc">
      <empty description="Run the garbage collector"/>
      <sequence description="Set heap debug flags">
        <option argLabel="set" longName="set"/>
        <repeat minCount="1"><argument argLabel="debugFlag"/></repeat>
      </sequence>
      <sequence description="Clear heap debug flags">
        <option argLabel="clear" longName="clear"/>
        <repeat minCount="1"><argument argLabel="debugFlag"/></repeat>
      </sequence>
      <option argLabel="show" longName="show" description="Show heap debug flags"/>
    </syntax>
    <syntax alias="grep">
      <sequence description="Search for lines that match a string or regex">
        <optionSet>
          <option argLabel="inverse" shortName="i"/>
          <option argLabel="isRegex" shortName="r"/>
        </optionSet>
        <argument argLabel="expression"/>
      </sequence>
    </syntax>
    <syntax alias="help">
      <empty description="Print help about 'help'"/>
      <argument argLabel="alias" description="Print help about a command alias or class"/>
    </syntax>
    <syntax alias="history">
      <empty description="List history entries"/>
      <sequence description="Run a history command">
        <alternatives><empty/><option argLabel="test" shortName="t" longName="test"/></alternatives>
        <alternatives>
          <argument argLabel="index"/>
          <argument argLabel="prefix"/>
        </alternatives>
      </sequence>
    </syntax>
    <syntax alias="isolate">
      <empty description="Show basic information about all isolates in the system"/>
    </syntax>
    <syntax alias="java" description="Run a Java class via its 'main' method">
      <sequence>
        <argument argLabel="className"/>
        <repeat><argument argLabel="arg"/></repeat>
      </sequence>
    </syntax>
    <syntax alias="kill" description="Kill a thread">
      <sequence>
        <repeat maxCount="1"><option argLabel="debug" longName="debug"/></repeat>
        <argument argLabel="threadId"/>
      </sequence>
    </syntax>
    <syntax alias="loadkeys">
      <empty description="Print the current keyboard layout"/>
      <sequence description="Change the keyboard layout">
        <argument argLabel="country"/>
        <optional>
          <argument argLabel="language"/>
          <optional>
            <argument argLabel="variant"/>
          </optional>
        </optional>
      </sequence>
    </syntax>
    <syntax alias="locale">
      <empty description="Print the current default Locale name"/>
      <option argLabel="list" longName="list" shortName="l" description="List the names of the available Locales"/>
      <sequence description="Change the default Locale">
        <argument argLabel="language"/>
        <optional>
          <argument argLabel="country"/>
          <optional>
            <argument argLabel="variant"/>
          </optional>
        </optional>
      </sequence>
    </syntax>
    <syntax alias="memory" description="Show JNode memory usage"/>
    <syntax alias="namespace" description="Print the contents of the system namespace"/>
    <syntax alias="onheap" description="Print heap object count and size statistics">
      <optionSet>
        <option argLabel="minCount" longName="minCount"/>
        <option argLabel="minTotalSize" longName="minTotalSize"/>
      </optionSet>
    </syntax> 
    <syntax alias="run" description="Run a command file">
      <argument argLabel="file"/>
    </syntax>
    <syntax alias="set">
      <sequence description="Set a system property">
        <argument argLabel="key"/>
        <argument argLabel="value"/>
      </sequence>
      <argument description="Remove a system property" argLabel="key"/>
    </syntax>
    <syntax alias="syntax">
      <empty description="List aliases which have syntaxes"/>
      <option argLabel="dumpAll" longName="dump-all" description="Dump all syntaxes"/>
      <sequence description="Dump the syntax for a given alias">
        <option argLabel="dump" longName="dump" shortName="d"/>
        <argument argLabel="alias"/>
      </sequence>
      <sequence description="Load a new syntax for a given alias">
        <option argLabel="file" longName="load" shortName="l"/>
        <argument argLabel="alias"/>
      </sequence>
      <sequence description="Set a system property">
        <option argLabel="remove" longName="remove" shortName="r"/>
        <argument argLabel="alias"/>
      </sequence>
    </syntax>
    <syntax alias="thread">
      <optional description="Display all extant JNode Threads">
        <option argLabel="groupDump" longName="groupDump" shortName="g" 
                description="Display as a ThreadGroup dump"/>
      </optional>
      <argument argLabel="threadName" description="Display the named Thread"/>
    </syntax>
  </extension>

  <extension point="org.jnode.security.permissions">
    <permission class="java.util.PropertyPermission" name="*" actions="read,write"/>
    <permission class="java.lang.RuntimePermission" name="getProtectionDomain"/>
    <permission class="java.lang.RuntimePermission" name="createClassLoader"/>
    <permission class="java.lang.RuntimePermission" name="setContextClassLoader"/>
    <permission class="java.lang.RuntimePermission" name="modifyThreadGroup"/>  
    <permission class="java.io.FilePermission" name="<<ALL FILES>>" actions="read,write"/>
    <permission class="org.jnode.security.JNodePermission" name="getVmThread"/>
    <permission class="org.jnode.security.JNodePermission" name="getVmClass"/>
    <permission class="java.net.SocketPermission" name="*" actions="resolve"/>
    <permission class="java.net.SocketPermission" name="*:0-" actions="connect,resolve"/>
    <permission class="java.lang.RuntimePermission" name="writeFileDescriptor"/>
    <permission class="java.lang.RuntimePermission" name="readFileDescriptor"/>
  </extension>

</plugin>
